<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Management</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        .form-container {
            display: none; /* Initially hide the form container */
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.4);
            width: 700px; /* Set width of the form container */
            max-height: 430px; /* Set maximum height of the form container */
            overflow-y: auto; /* Enable vertical scroll if content exceeds height */
            margin-left: 20%;
        }
        .form-label {
            font-size: 14px;
        }
        .form-control {
            font-size: 14px;
        }
        .btn-group {
            margin-top: 20px;
        }
        .search-container {
            margin-top: 20px;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        nav {
  background-color: #333;
  padding: 10px;
}

nav ul {
  list-style-type: none;
  padding: 0;
  
}

nav ul li {
  display: inline;
  margin-right: 10px;
}

nav ul li a {
  color: #fff;
  text-decoration: none;
  padding: 5px;
}

nav ul li a:hover {
  background-color: #555;
}
    </style>
</head>
<body>
    <nav>
        <ul>
          <li><a href="dashBoard.html">Home</a></li>
          <li><a href="customer.html">Customer</a></li>
          <li><a href="employee.html">Employee</a></li>
          <li><a href="item.html">Item</a></li>
          <li><a href="suplier.html">Supplier</a></li>
          <li><a href="sale.html">Order</a></li>
        </ul>
      </nav>

<div class="container mt-5">
    <h2 class="mb-4">Inventory Management</h2>
    <form id="inventoryForm" onsubmit="event.preventDefault(); saveInventory();">
        <div class="mb-3">
            <button type="button" class="btn btn-primary" onclick="editInventory()">Edit Inventory Item</button>

            <div class="form-container" id="inventoryFormContainer">
                <div class="mb-3">
                    <label for="itemCode" class="form-label">Item Code</label>
                    <input type="text" class="form-control" id="itemCode" placeholder="Enter Item Code" required>
                </div>
                <div class="mb-3">
                    <label for="itemDesc" class="form-label">Item Description</label>
                    <input type="text" class="form-control" id="itemDesc" placeholder="Enter Item Description" required>
                </div>
                <div class="mb-3">
                    <label for="itemPicture" class="form-label">Item Picture (Base64)</label>
                    <input type="hidden" class="form-control" id="itemPicture" name="itemPicture" required>
                    <img id="itemPicturePreview" src="" alt="Item Picture Preview" style="max-width: 100%; max-height: 200px; display: none;">
                    <input type="file" class="form-control" id="itemPicture1" accept="image/*" onchange="handleImageUpload(event)" required>
                </div>
                
                <div class="mb-3">
                    <label for="category" class="form-label">Category</label>
                    <input type="text" class="form-control" id="category" placeholder="Enter Category" required>
                </div>
                <div class="mb-3">
                    <label for="size" class="form-label">Size</label>
                    <input type="number" class="form-control" id="size" placeholder="Enter Size" required>
                </div>
                <div class="mb-3">
                    <label for="supplierCode" class="form-label">Supplier Code</label>
                    <input type="text" class="form-control" id="supplierCode" placeholder="Enter Supplier Code" required>
                </div>
                <div class="mb-3">
                    <label for="supplierName" class="form-label">Supplier Name</label>
                    <input type="text" class="form-control" id="supplierName" placeholder="Enter Supplier Name" required>
                </div>
                <div class="mb-3">
                    <label for="unitPriceSale" class="form-label">Unit Price - Sale</label>
                    <input type="number" class="form-control" id="unitPriceSale" placeholder="Enter Unit Price - Sale" required>
                </div>
                <div class="mb-3">
                    <label for="unitPriceBuy" class="form-label">Unit Price - Buy</label>
                    <input type="number" class="form-control" id="unitPriceBuy" placeholder="Enter Unit Price - Buy" required>
                </div>
                <div class="mb-3">
                    <label for="expectedProfit" class="form-label">Expected Profit</label>
                    <input type="number" class="form-control" id="expectedProfit" placeholder="Enter Expected Profit" required>
                </div>
                <div class="mb-3">
                    <label for="profitMargin" class="form-label">Profit Margin (%)</label>
                    <input type="number" class="form-control" id="profitMargin" placeholder="Enter Profit Margin" required>
                </div>
                <div class="mb-3">
                    <label for="status" class="form-label">Status</label>
                    <input type="text" class="form-control" id="status" placeholder="Enter Status" required>
                </div>
        
                <div class="btn-group d-flex justify-content-between">
                    <button type="submit" class="btn btn-primary">Save</button>
                    <button type="button" class="btn btn-success" onclick="updateInventory()">Update</button>
                    <button type="button" class="btn btn-danger" onclick="deleteInventory()">Delete</button>
                </div>
            </div>
        </div>
    </form>
    
    <div class="mt-5">
        <h2>Inventory Information Table</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>Item Code</th>
                    <th>Item Description</th>
                    <th> Picture</th>
                    <th>Category</th>
                    <th>Size</th>
                    <th>Supplier Code</th>
                    <th>Supplier Name</th>
                    <th>Unit Price - Sale</th>
                    <th>Unit Price - Buy</th>
                    <th>Expected Profit</th>
                    <th>Profit Margin (%)</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="inventoryTableBody" onclick="tableOnClick(event)">
                <tr>
                    <td></td>
                    <td></td>
                    <td><image></image></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    let inventoryItems = [];

    function saveInventory() {
        

        const inventoryItem = {
            itemCode: document.getElementById('itemCode').value,
            itemDesc: document.getElementById('itemDesc').value,
            itemPicture: document.getElementById('itemPicture').value,
            category: document.getElementById('category').value,
            size: document.getElementById('size').value,
            supplierCode: document.getElementById('supplierCode').value,
            supplierName: document.getElementById('supplierName').value,
            unitPriceSale: document.getElementById('unitPriceSale').value,
            unitPriceBuy: document.getElementById('unitPriceBuy').value,
            expectedProfit: document.getElementById('expectedProfit').value,
            profitMargin: document.getElementById('profitMargin').value,
            status: document.getElementById('status').value

        };

        $.ajax({
                url: 'http://localhost:8080/item/save',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(inventoryItem),
                success: function(response) {
                    document.getElementById('inventoryForm').reset();
                    alert('Item information saved successfully!');
                    updateInventoryTable();
                },
                error: function(xhr, status, error) {
                    console.error(error);
                    alert('Failed to save Item information. Please try again.');
                }
            });
        }

            function updateInventory() {

                const inventoryItem = {
            itemCode: document.getElementById('itemCode').value,
            itemDesc: document.getElementById('itemDesc').value,
            itemPicture: document.getElementById('itemPicture').value,
            category: document.getElementById('category').value,
            size: document.getElementById('size').value,
            supplierCode: document.getElementById('supplierCode').value,
            supplierName: document.getElementById('supplierName').value,
            unitPriceSale: document.getElementById('unitPriceSale').value,
            unitPriceBuy: document.getElementById('unitPriceBuy').value,
            expectedProfit: document.getElementById('expectedProfit').value,
            profitMargin: document.getElementById('profitMargin').value,
            status: document.getElementById('status').value
        };

        $.ajax({
        url: `http://localhost:8080/item/update`, 
        type: 'PATCH', 
        contentType: 'application/json',
        data: JSON.stringify(inventoryItem),
        success: function(response) {
            alert('Item information updated successfully!');
            updateInventoryTable();
            
        },
        error: function(xhr, status, error) {
            console.error(error);
            alert('Failed to update Item information. Please try again.');
            console.log(inventoryItem)
        }
    });
         
    }

    function deleteInventory() {
        const code = document.getElementById('itemCode').value;
   
    if (confirm('Are you sure you want to delete this Item?')) {
        $.ajax({
            url: `http://localhost:8080/item/${code}`, 
            type: 'DELETE', 
            success: function(response) {
                alert('Item information deleted successfully!');
                
                
            },
            error: function(xhr, status, error) {
                console.error(error);
                alert('Failed to delete Item information. Please try again.');
            }
        });
    }
    }

    

    function updateInventoryTable() {
    $.ajax({
        url: 'http://localhost:8080/item/getAllItem', 
        type: 'GET',
        dataType: 'json',
        success: function(response) {
            const tableBody = document.getElementById('inventoryTableBody');
            tableBody.innerHTML = '';  

            response.forEach(item => {
                const row = `
                    <tr>
                        <td>${item.itemCode}</td>
                        <td>${item.itemDesc}</td>
                        <td><img src="${item.itemPicture}" style="max-width: 100px; max-height: 100px;" /></td>
                        <td>${item.category}</td>
                        <td>${item.size}</td>
                        <td>${item.supplierCode}</td>
                        <td>${item.supplierName}</td>
                        <td>${item.unitPriceSale}</td>
                        <td>${item.unitPriceBuy}</td>
                        <td>${item.expectedProfit}</td>
                        <td>${item.profitMargin}</td>
                        <td>${item.status}</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        },
        error: function(xhr, status, error) {
            console.error(error);
            alert('Failed to fetch inventory data. Please try again.');
        }
    });
}



function tableOnClick(event) {
    const row = event.target.closest('tr'); 

    if (row) {
        const cells = row.querySelectorAll('td'); 

       
        if (cells.length >= 12) {
         
            const itemCode = cells[0].textContent;
            const itemDesc = cells[1].textContent;
            const itemPicture = cells[2].querySelector('img').getAttribute('src');
            const category = cells[3].textContent;
            const size = cells[4].textContent;
            const supplierCode = cells[5].textContent;
            const supplierName = cells[6].textContent;
            const unitPriceSale = cells[7].textContent;
            const unitPriceBuy = cells[8].textContent;
            const expectedProfit = cells[9].textContent;
            const profitMargin = cells[10].textContent;
            const status = cells[11].textContent;
       
            
            document.getElementById('itemCode').value = itemCode;
            document.getElementById('itemDesc').value = itemDesc;

            document.getElementById('itemPicture').value = itemPicture;
            document.getElementById('itemPicturePreview').src = itemPicture; 
            document.getElementById('itemPicturePreview').style.display = 'block'; 

            // document.getElementById('itemPicture').value = itemPicture;
            // document.getElementById('itemPicturePreview').src = itemPicture;
            // document.getElementById('itemPicturePreview').style.display = 'block';

            document.getElementById('category').value = category;
            document.getElementById('size').value = size;
            document.getElementById('supplierCode').value = supplierCode;
            document.getElementById('supplierName').value = supplierName;
            document.getElementById('unitPriceSale').value = unitPriceSale;
            document.getElementById('unitPriceBuy').value = unitPriceBuy;
            document.getElementById('expectedProfit').value = expectedProfit;
            document.getElementById('profitMargin').value = profitMargin;
            document.getElementById('status').value = status;

            
            document.getElementById('inventoryFormContainer').style.display = 'block';
            
        } else {
            console.error('Invalid row data. Expected at least 12 cells.'); // Log an error if row data is incomplete
        }
    }
}



updateInventoryTable();   

    function editInventory() {
       
        toggleInventoryFormContainer();
    }

    function toggleInventoryFormContainer() {
        
        const formContainer = document.getElementById('inventoryFormContainer');
        formContainer.style.display = formContainer.style.display === 'none' ? 'block' : 'none';
    }
    function handleImageUpload(event) {
    const file = event.target.files[0];

    if (file) {
        const reader = new FileReader();

        reader.onload = function (e) {
            const base64Image = e.target.result;
            document.getElementById('itemPicture').value = base64Image;
            document.getElementById('itemPicturePreview').src = base64Image;
            document.getElementById('itemPicturePreview').style.display = 'block';
        };

        reader.readAsDataURL(file);
    }
}


</script>

</body>
</html>
